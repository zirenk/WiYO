{% extends "base.html" %}

{% block content %}
<h1>Demographics</h1>
<form id="demographics-form" method="POST" action="{{ url_for('demographics') }}">
    <div class="mb-3">
        <button type="button" id="edit-toggle" class="btn btn-primary" onclick="toggleEditMode()">
            {% if edit_mode %}Cancel Edit{% else %}Edit Demographics{% endif %}
        </button>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>
    <div class="mb-3">
        <label for="age" class="form-label">Age</label>
        <input type="number" class="form-control" id="age" name="age" value="{{ user.demographics.age if user.demographics else '' }}" {% if not edit_mode %}readonly{% endif %} required>
    </div>
    <div class="mb-3">
        <label for="gender" class="form-label">Gender</label>
        <select class="form-select" id="gender" name="gender" {% if not edit_mode %}disabled{% endif %} required>
            <option value="">Select gender</option>
            <option value="male" {% if user.demographics and user.demographics.gender == 'male' %}selected{% endif %}>Male</option>
            <option value="female" {% if user.demographics and user.demographics.gender == 'female' %}selected{% endif %}>Female</option>
            <option value="other" {% if user.demographics and user.demographics.gender == 'other' %}selected{% endif %}>Other</option>
            <option value="prefer_not_to_say" {% if user.demographics and user.demographics.gender == 'prefer_not_to_say' %}selected{% endif %}>Prefer not to say</option>
        </select>
    </div>
    <div class="mb-3">
        <label for="education" class="form-label">Highest Level of Education</label>
        <select class="form-select" id="education" name="education" {% if not edit_mode %}disabled{% endif %} required>
            <option value="">Select education level</option>
            <option value="high_school" {% if user.demographics and user.demographics.education == 'high_school' %}selected{% endif %}>High School</option>
            <option value="bachelors" {% if user.demographics and user.demographics.education == 'bachelors' %}selected{% endif %}>Bachelor's Degree</option>
            <option value="masters" {% if user.demographics and user.demographics.education == 'masters' %}selected{% endif %}>Master's Degree</option>
            <option value="phd" {% if user.demographics and user.demographics.education == 'phd' %}selected{% endif %}>Ph.D. or higher</option>
        </select>
    </div>
    <!-- Add the remaining demographic fields here -->
    <button type="submit" id="submit-button" class="btn btn-primary" {% if not edit_mode %}style="display: none;"{% endif %}>Submit Demographics</button>
</form>
{% endblock %}

{% block extra_js %}
<script>
let editMode = {{ edit_mode|tojson }};

function toggleEditMode() {
    editMode = !editMode;
    const form = document.getElementById('demographics-form');
    const editToggle = document.getElementById('edit-toggle');
    const submitButton = document.getElementById('submit-button');

    form.querySelectorAll('input, select').forEach(element => {
        if (element.id !== 'edit-toggle') {
            element.disabled = !editMode;
            if (element.tagName === 'INPUT') {
                element.readOnly = !editMode;
            }
        }
    });

    editToggle.textContent = editMode ? 'Cancel Edit' : 'Edit Demographics';
    submitButton.style.display = editMode ? 'block' : 'none';
}

document.addEventListener('DOMContentLoaded', function() {
    if (editMode) {
        toggleEditMode();
    }
});
</script>
{% endblock %}
